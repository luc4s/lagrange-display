# lagrange-display


## Raspberry Pi Setup

### ssh connexion

To connect to the raspberry pi with ssh the first time, you need to create an empty file named `ssh` (without extension) in the boot partition of the SD card to allow incoming connexions. To be able to connect with the user `pi` password `raspberry`, put a file named `userconf.txt` containing the following line :

```
pi:$6$/4.VdYgDm7RJ0qM1$FwXCeQgDKkqrOU3RIRuDSKpauAbBvP11msq9X58c8Que2l1Dwq3vdJMgiZlQSbEXGaY5esVHGBNbCxKLVNqZW1
```

In Windows, go to the network settings -> Wifi network -> share -> check the box "Allow other network users to connect through this computer's Internet connection" -> select the network adapter corresponding to the raspberry pi (Ethernet) -> validate. Then, connect to the raspberry pi by typing :

```shell
ssh pi@raspberrypi.local
```

## Build the project

After cloning the project, go to the project directory and install java, maven and the libraries needed by the screen ([official site](https://www.waveshare.com/wiki/12.48inch_e-Paper_Module_(B))). Then run

```shell
./build.sh
```

It will build the jar that runs the spring boot service which fetches the movies schedules and the C file that displays them on the screen. 

Instead of displaying all lines one by one, the C programm will display an image containing all the text. This image is generated by the java program based on a json file and saved in the resources directory. 

## Run the project

Run the jar file in the background. It will periodically fetch the movies schedules and display them on the screen by calling the C program.

```shell
nohup java -jar app-1.0.0-SNAPSHOT.jar > app.log 2>&1 &
```

To start the app at boot startup, edit the cron file

```shell
crontab -e
```
and add the following line

```shell
@reboot cd /home/pi/lagrange-display && nohup java -jar app-1.0.0-SNAPSHOT.jar > app.log 2>&1 &
```
You can edit environment variables globally, for example
```shell
export FREQUENCY=3600000
```
## API specifications

You can dynamically load a new schedule by calling a POST endpoint. First authenticate to get the JWT then call the POST endpoint. For instance,

```yaml
[POST] /api/token

Body : 
  
{
  "username": "lagrange",
  "password": "lachancla"
}
```
```yaml
[POST] /api/movie

Header :

  Authorization: Bearer <JWT>

Body:

  {
    "title":"Cinéma La Grange",
    "description":"Programme du cinéma La Grange à Delémont",
    "date":"2023-12-15T16:32:22.277Z",
    "movies":
      [
        {
          "title": "..."
        }
      ]
  } 
```
